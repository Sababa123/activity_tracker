<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Activity Page</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="styles/kendo.common.min.css" />
        <link rel="stylesheet" href="styles/kendo.default.min.css" />
        <link rel="stylesheet" href="styles/kendo.default.mobile.min.css" />

        <script src="JS_files/js/jquery.min.js"></script>
        <script src="JS_files/js/kendo.all.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <style>
            a:hover { 
                text-decoration: none; 
            };
            .x {
                background: #00a651;
                color: #ffffff;
            }
        </style>
    </head>
    <body>

        <div class="jumbotron text-center">
          <h1 style="font-size: 45px">Scheduler App</h1>
          <p>Keeping track of activities</p> 
        </div>
          
        <div class="container">
          <div class="row">
            <div class="col-md-6">
              <h3>Information Pane</h3>
              <div class="demo-section k-content">
                    <label style="margin-top: 2em;">DATE:</label>
                    <input id="datepicker" value="" title="datepicker" style="width: 100%" />
                    <div class="col-sm-6">
                        <label style="margin-top: 2em;">START TIME:</label>
                        <input id="start" value="Start time" style="width: 100%;" />
                    </div>

                    <div class="col-sm-6">
                        <label style="margin-top: 2em;">END TIME:</label>
                        <input id="end" value="End time" style="width: 100%;" />
                    </div>
              </div>

              <div class="col-sm-12">
                <div style="margin-top: 2em;" class="dropdown">
                        <button class="btn btn-default dropdown-toggle" style="width:100%" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        Choose an activity<span class="caret"></span>
                        </button>
                        <ul id="list" class="dropdown-menu" style="width:100%" aria-labelledby="dropdownMenu">
                        </ul>
                </div>
              </div>  
              <div class="col-sm-12">
                    <div class="text-center">
                        <button type="button" id="func" class="btn btn-info" style="margin-top: 2em;" >Create Activity</button> 
                    </div> 
              </div> 
              
              <div class="col-sm-12">
                    <p class = "tpbutton btn-toolbar text-center">
                        <div class="text-center">
                            <a class = "btn navbar-btn btn-primary" id="prev" target = "_texturepack">PREVIOUS DAY</a>
                            <a class = "btn navbar-btn btn-success" id="next" target = "_texturepack">NEXT DAY</a>
                        </div>
                    </p>
               </div>
              <div style="margin-top: 2em;" id="new" class="col-sm-12">
              </div>         
            </div>

            <div class="col-md-6">
              <h3>Display Pane</h3>
              <div style="margin-top: 4em;" class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Till Date
                    <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                      <li><a>Daily</a></li>
                      <li><a>Custom Date</a></li>
                      <li><a>Weekly</a></li>
                      <li><a>Last 7 Days</a></li>
                      <li><a>Monthly</a></li>
                      <li><a>Last 30 Days</a></li>
                      <li><a>Till Date</a></li>
                    </ul>
              </div> 
              <div id="date1">
                <br>
                <input id="datepicker1" value="Choose a date" title="datepicker" style="width: 100%"/> 
              </div>   
              <div id="piechart"></div>
              <div id="act">
              </div>          
              <div id="chart_div"></div>
            </div>
            <div class="text-right">
                <a href="screen2.html" class="btn btn-link" role="button">Go to activity type page...</a>
            </div>
          </div>
        </div>
        
    </body>
    <script type="text/javascript">
        function deleteThis(obj){
            var x = $(obj).closest('p');
            x = x["context"];
            x = x.getElementsByTagName("p");
            var d = {
                "id": x[0].innerHTML
            };
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/delete_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(d)
            }

            $.ajax(settings).done(function (response) {
                console.log(response);
                console.log($(obj).closest('section').remove());
                console.log($timesp);
                bar();
                update_startDate();
                if ($timesp == "Last 7 Days") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart1);
                } else if ($timesp == "Last 30 Days") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart2);
                } else if ($timesp == "Daily") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart4);
                } else if ($timesp == "Till Date") {
                    $("#date1").hide();
                    plot();
                } else if ($timesp == "Weekly") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart6);
                } else if ($timesp == "Monthly") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart7);
                } else {
                    plot();
                }
            });
        };

        function addMinutes(time, minsToAdd) {
            function D(J){ return (J<10? '0':'') + J};    
            var piece = time.split(':');
            var mins = piece[0]*60 + +piece[1] + +minsToAdd;
            return D(mins%(24*60)/60 | 0) + ':' + D(mins%60);  
        }  

            function update_startDate(){
                var curr = $("#datepicker").val();
                var val = {
                    "date": curr
                };

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                        "method": "POST",
                        "processData": false,
                        "data": JSON.stringify(val)
                    }

                    $.ajax(settings).done(function (response) {
                        var resp = response["custom_date"];
                        if (Object.keys(resp).length == 3) {
                            var date = new Date(document.getElementById("datepicker").value);
                            date.setDate(date.getDate() - 1);
                            var finalDate = (date.getMonth()+1) +'/'+ date.getDate() +'/'+date.getFullYear();
                            
                            var val = {
                                "date": finalDate
                            };
                            
                            var settings = {
                                "async": true,
                                "crossDomain": true,
                                "url": "http://localhost:8000/get_activity/",
                                "method": "POST",
                                "processData": false,
                                "data": JSON.stringify(val)
                            }

                            $.ajax(settings).done(function (response) {
                                console.log(response["custom_date"]);
                                if(Object.keys(response["custom_date"]).length > 3) {
                                    var record = response["custom_date"][(Object.keys(response["custom_date"]).length)-4];
                                    console.log(record);
                                    //$("#start").kendoTimePicker();
                                    var timepicker = $("#start").data("kendoTimePicker");
                                    timepicker.value(tConvert(record["end_time"]));
                                    //$("#end").kendoTimePicker();
                                    var timepicker1 = $("#end").data("kendoTimePicker");
                                    timepicker1.value(tConvert(addMinutes(record["end_time"], '30')));
                                } else {
                                    document.getElementById("start").value = "Start Date";
                                    document.getElementById("end").value = "End Date";
                                }
                            });
                        } else {
                            var record = resp[Object.keys(resp).length-4];
                            //$("#start").kendoTimePicker();
                            var timepicker = $("#start").data("kendoTimePicker");
                            timepicker.value(tConvert(record["end_time"]));
                            //$("#end").kendoTimePicker();
                            var timepicker1 = $("#end").data("kendoTimePicker");
                            timepicker1.value(tConvert(addMinutes(record["end_time"], '30')));
                        }
                });
            };

        $(document).ready(function() {
            $("#date1").hide();
            var $type;

            var todayDate = kendo.toString(kendo.parseDate(new Date()), 'MM/dd/yyyy');
            $("#datepicker").data("kendoDatePicker").value(todayDate);

            function view_cat () {
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_category/",
                    "method": "GET"
                }

                $.ajax(settings).done(function (response) {
                    var resp = response["categories_dict"];
                    for (i = 0, len = Object.keys(resp).length; i < len; i++) {    
                        var name = resp[i]["name"];
                        var col = resp[i]["bar_color"];
                        var newdiv =  document.createElement('li');
                        newdiv.innerHTML = '<div class="col-md-12" style="margin-top:5px;"><div class="col-sm-6"><a style="color:"black";>'+name+'</a></div><div class="col-md-6"><span class="pull-right"><p style="width:50px; height:15px;" class="col"></p></span></div></div>';
                        $('#list').append(newdiv);
                        var c = '#' + col;
                        var act = $(".col");
                        act = act[($(".col").length)-1];
                        console.log(act);
                        act.style.backgroundColor = c;
                    }

                    $("body").on('click', '.dropdown-menu li div', function () {
                        $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
                        $(this).parents(".dropdown").find('.btn');
                        $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
                        $type = $(this).text();
                    });

                    $("#func").click(function(){
                        var date, start,end, type;
                        
                        date1 = document.getElementById('datepicker').value;
                        start = document.getElementById('start').value;
                        end = document.getElementById('end').value;
                        var abs_start = convert(start);
                        var abs_end = convert(end);
                        var time_diff = diff(abs_start,abs_end);
                        console.log(time_diff);
                        if (start == "Start time" || end == "End time" || $type == undefined) {
                            alert("Enter all values");
                            //document.getElementById('new').appendChild(newdiv);
                            document.getElementById('dropdownMenu1').innerHTML = "Choose an activity" + '<span class="caret"></span>';
                        } else {
                            /*var newdiv = document.createElement('div');
                            newdiv.innerHTML = '<div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+start+'  -  '+end+'<button type="button" class="close" data-target="#copyright-wrap" data-dismiss="alert"> <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+$type+'<br></a></div></div></div>' 
                            document.getElementById('new').appendChild(newdiv);*/
                            var v1 = {
                                "name": $type
                            };

                            var settings = {
                                "async": true,
                                "crossDomain": true,
                                "url": "http://localhost:8000/custom_category/",
                                "method": "POST",
                                "processData": false,
                                "data": JSON.stringify(v1)
                            }

                            $.ajax(settings).done(function (response) {
                                var resp = response["categories_dict"][0];
                                var bar_col = resp["bar_color"];
                                var group_num = resp["group_num"];
                                var v = {
                                    "date":date1,
                                    "start_time":abs_start,
                                    "end_time":abs_end,
                                    "elapsed_time":time_diff,
                                    "category_name": v1["name"],
                                    "category_bar_color": bar_col,
                                    "category_group_num": group_num
                                }
                                
                                var settings = {
                                    "async": true,
                                    "crossDomain": true,
                                    "url": "http://localhost:8000/activity/",
                                    "method": "POST",
                                    "processData": false,
                                    "data": JSON.stringify(v)
                                }

                                $.ajax(settings).done(function (response) {
                                    bar();
                                    plot();
                                    update_startDate();
                                    if ($timesp == "Last 7 Days") {
                                    $("#date1").hide();
                                    google.charts.load('current', {'packages':['corechart']});
                                    google.charts.setOnLoadCallback(drawChart1);
                                    } else if ($timesp == "Last 30 Days") {
                                        $("#date1").hide();
                                        google.charts.load('current', {'packages':['corechart']});
                                        google.charts.setOnLoadCallback(drawChart2);
                                    } else if ($timesp == "Daily") {
                                        $("#date1").hide();
                                        google.charts.load('current', {'packages':['corechart']});
                                        google.charts.setOnLoadCallback(drawChart4);
                                    } else if ($timesp == "Till Date") {
                                        $("#date1").hide();
                                        plot();
                                    } else if ($timesp == "Weekly") {
                                        $("#date1").hide();
                                        google.charts.load('current', {'packages':['corechart']});
                                        google.charts.setOnLoadCallback(drawChart6);
                                    } else if ($timesp == "Monthly") {
                                        $("#date1").hide();
                                        google.charts.load('current', {'packages':['corechart']});
                                        google.charts.setOnLoadCallback(drawChart7);
                                    } else {
                                        plot();
                                    }

                                    var val = {
                                        "date": date1
                                    };

                                    var settings = {
                                        "async": true,
                                        "crossDomain": true,
                                        "url": "http://localhost:8000/get_activity/",
                                            "method": "POST",
                                            "processData": false,
                                            "data": JSON.stringify(val)
                                    }

                                    $.ajax(settings).done(function (response) {
                                        document.getElementById('new').innerHTML = "";
                                        var resp = response["custom_date"];
                                        for (i = 0, len = Object.keys(resp).length-3; i < len; i++) { 
                                            var newdiv = document.createElement('div');
                                            newdiv.innerHTML = '<section><div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+tConvert(resp[i]["start_time"])+'  -  '+tConvert(resp[i]["end_time"])+'<button type="button" onclick="deleteThis(this)" class="close" data-dismiss="alert"><p style="display:none">'+resp[i]["id"]+'</p><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+resp[i]["category_name"]+'<br></div></div></div></section>' 
                                            document.getElementById('new').appendChild(newdiv);
                                        }
                                    });
                                });
                            });

                            //document.getElementById('datepicker').value = "Choose a date";
                            document.getElementById('start').value = "Start time";
                            document.getElementById('end').value = "End time";
                            document.getElementById('dropdownMenu1').innerHTML = "Choose an activity" + '<span class="caret"></span>';
                            $type = undefined;
                        }
                    });
                });
            }

            function start(){
                var curr = $("#datepicker").val();
                var val = {
                    "date": curr
                };

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                        "method": "POST",
                        "processData": false,
                        "data": JSON.stringify(val)
                    }

                    $.ajax(settings).done(function (response) {
                        document.getElementById('new').innerHTML = "";
                        var resp = response["custom_date"];
                        for (i = 0, len = Object.keys(resp).length-3; i < len; i++) { 
                            var newdiv = document.createElement('div');
                            newdiv.innerHTML = '<section><div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+tConvert(resp[i]["start_time"])+'  -  '+tConvert(resp[i]["end_time"])+'<button type="button" onclick="deleteThis(this)" class="close" data-dismiss="alert"><p style="display:none">'+resp[i]["id"]+'</p><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+resp[i]["category_name"]+'<br></div></div></div></section>' 
                            document.getElementById('new').appendChild(newdiv);
                        }
                        update_startDate();
                });
            }

            start();
            view_cat();
            
            $("#datepicker").change(function(){
                var curr = $("#datepicker").val();
                var val = {
                    "date": curr
                };

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                        "method": "POST",
                        "processData": false,
                        "data": JSON.stringify(val)
                    }

                    $.ajax(settings).done(function (response) {
                        bar();
                        update_startDate();
                        document.getElementById('new').innerHTML = "";
                        var resp = response["custom_date"];
                        for (i = 0, len = Object.keys(resp).length-3; i < len; i++) { 
                            var newdiv = document.createElement('div');
                            newdiv.innerHTML = '<section><div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+tConvert(resp[i]["start_time"])+'  -  '+tConvert(resp[i]["end_time"])+'<button type="button" onclick="deleteThis(this)" class="close" data-dismiss="alert"><p style="display:none">'+resp[i]["id"]+'</p><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+resp[i]["category_name"]+'<br></div></div></div></section>' 
                            document.getElementById('new').appendChild(newdiv);
                        }
                        
                        if ($timesp == "Last 7 Days") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart1);
                        } else if ($timesp == "Last 30 Days") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart2);
                        } else if ($timesp == "Daily") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart4);
                        } else if ($timesp == "Till Date") {
                            $("#date1").hide();
                            plot();
                        } else if ($timesp == "Weekly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart6);
                        } else if ($timesp == "Monthly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart7);
                        } else {
                            plot();
                        }
                });
            });

            $("#prev").click(function(){
                var date = new Date(document.getElementById("datepicker").value);
                date.setDate(date.getDate() - 1);
                var finalDate = (date.getMonth()+1) +'/'+ date.getDate() +'/'+date.getFullYear();
                document.getElementById("datepicker").value = finalDate;

                var v = {
                    "date": finalDate
                };

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                    "method": "POST",
                    "processData": false,
                    "data": JSON.stringify(v)
                }

                $.ajax(settings).done(function (response) {
                    bar();
                    update_startDate();
                    document.getElementById('new').innerHTML = "";
                    var resp = response["custom_date"];
                    for (i = 0, len = Object.keys(resp).length-3; i < len; i++) { 
                        var newdiv = document.createElement('div');
                        newdiv.innerHTML = '<section><div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+tConvert(resp[i]["start_time"])+'  -  '+tConvert(resp[i]["end_time"])+'<button type="button" onclick="deleteThis(this)" class="close" data-dismiss="alert"><p style="display:none">'+resp[i]["id"]+'</p><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+resp[i]["category_name"]+'<br></div></div></div></section>' 
                        document.getElementById('new').appendChild(newdiv);
                    }
                    if ($timesp == "Last 7 Days") {
                        $("#date1").hide();
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(drawChart1);
                        } else if ($timesp == "Last 30 Days") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart2);
                        } else if ($timesp == "Daily") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart4);
                        } else if ($timesp == "Till Date") {
                            $("#date1").hide();
                            plot();
                        } else if ($timesp == "Weekly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart6);
                        } else if ($timesp == "Monthly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart7);
                        }
                });
        });

        $("#next").click(function(){
                var date = new Date(document.getElementById("datepicker").value);
                date.setDate(date.getDate() + 1);
                var finalDate = (date.getMonth()+1) +'/'+ date.getDate() +'/'+date.getFullYear();
                document.getElementById("datepicker").value = finalDate;

                var v = {
                    "date": finalDate
                };
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                    "method": "POST",
                    "processData": false,
                    "data": JSON.stringify(v)
                }

                $.ajax(settings).done(function (response) {
                    bar();
                    update_startDate();
                    document.getElementById('new').innerHTML = "";
                    var resp = response["custom_date"];
                    for (i = 0, len = Object.keys(resp).length-3; i < len; i++) { 
                        var newdiv = document.createElement('div');
                        newdiv.innerHTML = '<section><div class="col-md-16"><div class="panel panel-primary copyright-wrap" id="copyright-wrap"><div class="panel-heading">'+tConvert(resp[i]["start_time"])+'  -  '+tConvert(resp[i]["end_time"])+'<button type="button" onclick="deleteThis(this)" class="close" data-dismiss="alert"><p style="display:none">'+resp[i]["id"]+'</p><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div><div class="panel-body">'+resp[i]["category_name"]+'<br></div></div></div></section>' 
                        document.getElementById('new').appendChild(newdiv);
                    }
                    if ($timesp == "Last 7 Days") {
                        $("#date1").hide();
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(drawChart1);
                        } else if ($timesp == "Last 30 Days") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart2);
                        } else if ($timesp == "Daily") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart4);
                        } else if ($timesp == "Till Date") {
                            $("#date1").hide();
                            plot();
                        } else if ($timesp == "Weekly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart6);
                        } else if ($timesp == "Monthly") {
                            $("#date1").hide();
                            google.charts.load('current', {'packages':['corechart']});
                            google.charts.setOnLoadCallback(drawChart7);
                        }
                });
        });

        function tConvert (time) {
                // Check correct time format and split into components
            time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

            if (time.length > 1) { // If time format correct
                time = time.slice (1);  // Remove full string match value
                time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
                time[0] = +time[0] % 12 || 12; // Adjust hours
            }
            return time.join (''); // return adjusted time or original string
        }

        function startChange() {
            var startTime = start.value();
            if (startTime) {
                startTime = new Date(startTime);
                end.max(startTime);
                startTime.setMinutes(startTime.getMinutes() + this.options.interval);
                end.min(startTime);
                end.value(startTime);
            }
        };

        //init start timepicker
        var start = $("#start").kendoTimePicker({
            change: startChange,
            interval: 15,
        }).data("kendoTimePicker");

        //init end timepicker
        var end = $("#end").kendoTimePicker({
            interval: 15
        }).data("kendoTimePicker");

        //define min/max range
        start.min("12:00 AM");
        start.max("12:00 AM");

        //define min/max range
        end.min("12:00 AM");
        end.max("12:00 AM");
        });

        $("#datepicker").kendoDatePicker();
        $("#datepicker1").kendoDatePicker();
        $("#monthpicker").kendoDatePicker({
            // defines the start view
            start: "year",

            // defines when the calendar should return date
            depth: "year",

            // display month and year in the input
            format: "MMMM yyyy",

            // specifies that DateInput is used for masking the input element
            dateInput: true
        });

        $("#datepicker").attr("readonly", true);
        $("#monthpicker").attr("readonly", true);

        function diff(start, end) {
            start = start.split(":");
            end = end.split(":");
            var startDate = new Date(0, 0, 0, start[0], start[1], 0);
            var endDate = new Date(0, 0, 0, end[0], end[1], 0);
            var diff = endDate.getTime() - startDate.getTime();
            var hours = Math.floor(diff / 1000 / 60 / 60);
            diff -= hours * 1000 * 60 * 60;
            var minutes = Math.floor(diff / 1000 / 60);
            var min = ((minutes < 9 ? "0" : "") + minutes)/60;
            var actual = min + hours;
            if(actual<0) {
                return(actual+24);
            } else {
                return (actual);
            }
        }

        function convert(x) {
            var time = x;
            var hours = Number(time.match(/^(\d+)/)[1]);
            var minutes = Number(time.match(/:(\d+)/)[1]);
            var AMPM = time.match(/\s(.*)$/)[1];
            if(AMPM == "PM" && hours<12) hours = hours+12;
            if(AMPM == "AM" && hours==12) hours = hours-12;
            var sHours = hours.toString();
            var sMinutes = minutes.toString();
            if(hours<10) sHours = "0" + sHours;
            if(minutes<10) sMinutes = "0" + sMinutes;
            var abs_time = sHours + ":" + sMinutes;
            return abs_time;
        };

        var $type,$timesp;

        $(".dropdown-menu li a").click(function(){
            $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
            $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
            if ($(this).text() != "Daily" && $(this).text() != "Weekly" && $(this).text() != "Last 7 Days" && $(this).text() != "Monthly" && $(this).text() != "Last 30 Days" && $(this).text() != "Till Date" && $(this).text() != "Custom Date") {
                $type = $(this).text();
            } else if($(this).text() == "Daily" || $(this).text() == "Weekly" || $(this).text() == "Last 7 Days" || $(this).text() == "Monthly" || $(this).text() == "Last 30 Days" || $(this).text() == "Till Date" || $(this).text() == "Custom Date") {
                $timesp = $(this).text();
                if ($timesp == "Last 7 Days") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart1);
                } else if ($timesp == "Last 30 Days") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart2);
                } else if ($timesp == "Daily") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart4);
                } else if ($timesp == "Till Date") {
                    $("#date1").hide();
                    plot();
                } else if ($timesp == "Custom Date") {
                    $("#date1").show();
                    $("#date1").change(function(){
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(drawChart3);
                    });
                } else if ($timesp == "Weekly") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart6);
                } else if ($timesp == "Monthly") {
                    $("#date1").hide();
                    google.charts.load('current', {'packages':['corechart']});
                    google.charts.setOnLoadCallback(drawChart7);
                } 
            } 
        });

        function plot () {
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);

            // Draw the chart and set the chart values
            function drawChart() {
                document.getElementById("act").innerHTML = "";

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                    "method": "POST",
                    "processData": false,
                    "data": "{\n\t\"date\":\"7/25/2019\"\n}"
                }

                $.ajax(settings).done(function (response) {
                    var colors = {};
                    var resp = response["tilldate"];
                    var resp1 = resp["category"];
                    var resp2 = resp["groups"];
                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Activity');
                    data.addColumn('number', 'Total Hours');
                    for (var index in resp1) { 
                        data.addRows([
                            [index,resp1[index]["total"]]
                        ]);
                        colors[index] = resp1[index]["category_bar_color"];
                    };

                    data.sort([{column: 1, desc: true}]);

                    //build slices
                    var slices = [];
                    for (var i = 0; i < data.getNumberOfRows(); i++) {
                        slices.push({
                        color: colors[data.getValue(i, 0)]
                        });
                    };

                    document.getElementById('act').innerHTML = "";
                    for (var index in resp2) { 
                        var newdiv = document.createElement('div');
                        newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                        document.getElementById('act').appendChild(newdiv);
                    };

                    var options = {'title':'Hours Spared', 'width':550, 'height':400};
                    var container = document.getElementById('piechart');
                    var chart = new google.visualization.PieChart(container);
                    chart.draw(data, {
                        slices: slices,
                        'title':'Hours Spared', 
                        'width':550, 
                        'height':400,
                         is3D: true
                    });
                });
            }
        }

        plot();
        function drawChart4() {
            document.getElementById("act").innerHTML = "";

            var d = {
                "date": document.getElementById("datepicker").value
            }
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(d)
            }

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["custom_date"];
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }
                
                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function drawChart1() {
            document.getElementById("act").innerHTML = "";

            var v = {
                "date":document.getElementById("datepicker").value
            };

            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(v)
            };

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["last_7"];
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }

                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function drawChart2() {
            document.getElementById("act").innerHTML = "";

            var v = {
                "date":document.getElementById("datepicker").value
            };

            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(v)
            }

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["last_30"];
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);

                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }
                
                var options = {'title':'Hours Spared', 'width':550, 'height':400};
                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function drawChart3() {
            document.getElementById("act").innerHTML = "";

            var d = {
                "date": document.getElementById("datepicker1").value
            };

            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(d)
            };

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["custom_date"];
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);

                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }
                
                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function drawChart6() {
            document.getElementById("act").innerHTML = "";

            var v = {
                "date":document.getElementById("datepicker").value
            };

            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(v)
            };

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["tillweek"];
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);
                
                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }
                
                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function drawChart7() {
            document.getElementById("act").innerHTML = "";

            var v = {
                "date":document.getElementById("datepicker").value
            };

            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8000/get_activity/",
                "method": "POST",
                "processData": false,
                "data": JSON.stringify(v)
            }

            $.ajax(settings).done(function (response) {
                var colors = {};
                var resp = response["month"];
                console.log(resp);
                var resp1 = resp["category"];
                var resp2 = resp["groups"];
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Activity');
                data.addColumn('number', 'Total Hours');
                for (var index in resp1) { 
                    data.addRows([
                        [index,resp1[index]["total"]]
                    ]);
                    colors[index] = resp1[index]["category_bar_color"];
                };

                data.sort([{column: 1, desc: true}]);

                document.getElementById('act').innerHTML = "";
                for (var index in resp2) { 
                    var newdiv = document.createElement('div');
                    newdiv.innerHTML = '<div class="panel panel-info"><div class="panel-heading">'+index+' activities: '+resp2[index]+' hr(s)</div>' 
                    document.getElementById('act').appendChild(newdiv);
                };

                //build slices
                var slices = [];
                for (var i = 0; i < data.getNumberOfRows(); i++) {
                    slices.push({
                    color: colors[data.getValue(i, 0)]
                    });
                }
                
                var options = {'title':'Hours Spared', 'width':550, 'height':400};
                var container = document.getElementById('piechart');
                var chart = new google.visualization.PieChart(container);
                chart.draw(data, {
                    slices: slices,
                    'title':'Hours Spared', 
                    'width':550, 
                    'height':400,
                     is3D: true
                });
            });
        }

        function bar() {
            google.charts.load('current', {'packages':['bar']});
            google.charts.setOnLoadCallback(drawChart5);

            function drawChart5() {
                var d = {
                    "date": document.getElementById("datepicker").value
                }
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "http://localhost:8000/get_activity/",
                    "method": "POST",
                    "processData": false,
                    "data": JSON.stringify(d)
                }

                $.ajax(settings).done(function (response) {
                    var colors = {};
                    var dat = {};
                    var arr = [];
                    var series = [];
                    var resp = response["custom_date"];
                    var resp1 = resp["category"];
                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Time');
                    for (var index in resp1) { 
                        data.addColumn('number', index);
                        arr.push(index);
                        var dict = {
                            color: resp1[index]["category_bar_color"],
                            visibleInLegend: true
                        };
                        series.push(dict);
                    };
                    data.addRows(Object.keys(resp).length-3);
                    for (i = 0, len = arr.length; i < len; i++) {
                        for (j = 0, len1 = Object.keys(resp).length-3; j < len1; j++) { 
                            if(arr[i] == resp[j]["category_name"]) {
                                data.setValue(j, 0, tConvert(resp[j]["start_time"]).toString());
                                data.setValue(j, i+1, resp[j]["elapsed_time"]);
                            } else {
                                console.log("No",+arr[i]+resp[j]["category_name"]+j);
                            }
                        }
                    };
                    var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
                    chart.draw(data, {isStacked: true, width: 550, height: 450, title: 'Activities throughout the day',
                        vAxis: {title: 'Times of the day', titleTextStyle: {color: 'black'}},
                        series: series
                    });
                });
            }              
        }

        function tConvert (time) {
                // Check correct time format and split into components
            time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

            if (time.length > 1) { // If time format correct
                time = time.slice (1);  // Remove full string match value
                time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
                time[0] = +time[0] % 12 || 12; // Adjust hours
            }
            return time.join (''); // return adjusted time or original string
        }
        bar();   
    </script>
</html>
